<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Prova Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1 {
      margin-top: 0;
    }

    .info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .question {
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #ddd;
    }

    .alternative {
      display: block;
      margin: 6px 0;
      cursor: pointer;
    }

    button {
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #1976d2;
      color: white;
    }

    button:disabled {
      background: #999;
      cursor: not-allowed;
    }

    .timer {
      color: #d32f2f;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Prova Online</h1>

    <div class="info">
      <div>ID da Prova: <span id="provaId">---</span></div>
      <div class="timer">Tempo restante: <span id="tempo">--:--</span></div>
    </div>

    <div id="questoes"></div>

    <button id="btnEnviar" onclick="enviarProva()">Enviar Prova</button>
  </div>

  <script>
    // ðŸ”— WEBHOOKS
    const WEBHOOK_PROVA = "https://webhook.artideia.com.br/webhook/buscar-prova-ativa";
    const WEBHOOK_RESPOSTAS = "https://SEU_WEBHOOK/enviar-respostas";

    let provaId = null;
    let fimProva = null;
    let respostas = {};
    let enviada = false;

    async function carregarProva() {
      try {
        const res = await fetch(WEBHOOK_PROVA, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({})
        });

        const data = await res.json();

        if (data.erro) {
          alert("Nenhuma prova disponÃ­vel.");
          return;
        }

        provaId = data.prova_id;
        document.getElementById("provaId").innerText = provaId;

        fimProva = new Date(data.fim);

        renderizarQuestoes(data.questoes);
        iniciarTimer();

      } catch (e) {
        console.error(e);
        alert("Erro ao carregar a prova.");
      }
    }

    function renderizarQuestoes(questoes) {
      const container = document.getElementById("questoes");
      container.innerHTML = "";

      questoes.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";

        const titulo = document.createElement("h3");
        titulo.textContent = `${i + 1}. ${q.Enunciado}`;
        div.appendChild(titulo);

        if (q.Tipo_questao === "multipla" && Array.isArray(q.Alternativas)) {
          q.Alternativas.forEach((alt) => {
            const label = document.createElement("label");
            label.className = "alternative";

            const input = document.createElement("input");
            input.type = "radio";
            input.name = `q${i}`;
            input.value = alt.texto;

            input.addEventListener("change", () => {
              respostas[i] = alt.texto;
            });

            label.appendChild(input);
            label.appendChild(document.createTextNode(" " + alt.texto));

            div.appendChild(label);
          });
        }

        container.appendChild(div);
      });
    }

    function iniciarTimer() {
      const el = document.getElementById("tempo");

      const interval = setInterval(() => {
        const agora = new Date();
        const diff = fimProva - agora;

        if (diff <= 0) {
          clearInterval(interval);
          el.innerText = "00:00";
          enviarProva();
          return;
        }

        const min = Math.floor(diff / 60000);
        const sec = Math.floor((diff % 60000) / 1000);

        el.innerText =
          String(min).padStart(2, "0") + ":" +
          String(sec).padStart(2, "0");
      }, 1000);
    }

    async function enviarProva() {
      if (enviada) return;

      enviada = true;
      document.getElementById("btnEnviar").disabled = true;

      try {
        await fetch(WEBHOOK_RESPOSTAS, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prova_id: provaId,
            respostas: respostas,
            enviado_em: new Date().toISOString()
          })
        });

        alert("Prova enviada com sucesso.");

      } catch (e) {
        console.error(e);
        alert("Erro ao enviar a prova.");
      }
    }

    // ðŸš€ InicializaÃ§Ã£o
    carregarProva();
  </script>
</body>
</html>
